## 10 â€” User Authentication: Signup, Login, Logout (Basic Views)

**Goal:** Add simple, working **user authentication** â€” signup, login, and logout â€” using Djangoâ€™s built-in authentication system. This lesson will give the Helpdesk project a user foundation to build roles, permissions, and ticket creation later.

---

### ğŸ”¹ Step 1 â€” Enable Authentication URLs in `config/urls.py`

Open `config/urls.py` and make sure it looks like this:

```python
from django.contrib import admin
from django.urls import path, include
from django.shortcuts import redirect

urlpatterns = [
    path('admin/', admin.site.urls),

    # Redirect root to login (temporary)
    path('', lambda request: redirect('login'), name='home'),

    # Include helpdesk app URLs
    path('helpdesk/', include('helpdesk.urls')),

    # Djangoâ€™s built-in authentication views (for now)
    path('accounts/', include('django.contrib.auth.urls')),
]
```

âœ… **Explanation:**

* `django.contrib.auth.urls` automatically provides ready-made URLs for:

  * `/accounts/login/`
  * `/accounts/logout/`
  * `/accounts/password_change/`, etc.
* Weâ€™ll soon replace default templates with our own.

---

### ğŸ”¹ Step 2 â€” Create URL patterns in `helpdesk/urls.py`

Inside your `helpdesk` app, create a file named `urls.py` if it doesnâ€™t exist:

```python
from django.urls import path
from . import views

urlpatterns = [
    path('signup/', views.signup_view, name='signup'),
]
```

âœ… This connects the signup route to a new view youâ€™ll create next.

---

### ğŸ”¹ Step 3 â€” Create Signup, Login, and Logout Views

Open `helpdesk/views.py` and add the following code:

```python
from django.shortcuts import render, redirect
from django.contrib.auth import login, logout, authenticate
from django.contrib.auth.forms import UserCreationForm, AuthenticationForm
from django.contrib import messages

def signup_view(request):
    if request.method == 'POST':
        form = UserCreationForm(request.POST)
        if form.is_valid():
            user = form.save()
            messages.success(request, "Account created successfully! You can now log in.")
            return redirect('login')
        else:
            messages.error(request, "Please correct the errors below.")
    else:
        form = UserCreationForm()
    return render(request, 'helpdesk/signup.html', {'form': form})

def login_view(request):
    if request.method == 'POST':
        form = AuthenticationForm(data=request.POST)
        if form.is_valid():
            user = form.get_user()
            login(request, user)
            messages.success(request, f"Welcome, {user.username}!")
            return redirect('helpdesk_home')
        else:
            messages.error(request, "Invalid username or password.")
    else:
        form = AuthenticationForm()
    return render(request, 'helpdesk/login.html', {'form': form})

def logout_view(request):
    logout(request)
    messages.info(request, "You have been logged out.")
    return redirect('login')
```

âœ… **Explanation:**

* `UserCreationForm` â€” built-in signup form.
* `AuthenticationForm` â€” built-in login form.
* `login()` and `logout()` â€” Django session-based authentication.
* `messages` â€” provides feedback for users (e.g., â€œLogged out successfullyâ€).

---

### ğŸ”¹ Step 4 â€” Create Templates (Signup, Login, Base)

1. Create a new folder structure for templates:

   ```
   templates/
   â””â”€â”€ helpdesk/
       â”œâ”€â”€ base.html
       â”œâ”€â”€ signup.html
       â””â”€â”€ login.html
   ```

2. **`base.html`** (shared layout):

   ```html
   <!DOCTYPE html>
   <html lang="en">
   <head>
       <meta charset="UTF-8">
       <title>Helpdesk</title>
       <link rel="stylesheet" href="/static/css/style.css">
   </head>
   <body>
       <nav>
           <a href="{% url 'helpdesk_home' %}">Home</a> |
           {% if user.is_authenticated %}
               <a href="{% url 'logout' %}">Logout</a>
           {% else %}
               <a href="{% url 'login' %}">Login</a> |
               <a href="{% url 'signup' %}">Signup</a>
           {% endif %}
       </nav>
       <hr>
       {% if messages %}
           {% for message in messages %}
               <p>{{ message }}</p>
           {% endfor %}
       {% endif %}
       {% block content %}{% endblock %}
   </body>
   </html>
   ```

3. **`signup.html`:**

   ```html
   {% extends 'helpdesk/base.html' %}
   {% block content %}
   <h2>Signup</h2>
   <form method="POST">
       {% csrf_token %}
       {{ form.as_p }}
       <button type="submit">Create Account</button>
   </form>
   {% endblock %}
   ```

4. **`login.html`:**

   ```html
   {% extends 'helpdesk/base.html' %}
   {% block content %}
   <h2>Login</h2>
   <form method="POST">
       {% csrf_token %}
       {{ form.as_p }}
       <button type="submit">Login</button>
   </form>
   {% endblock %}
   ```

âœ… These are minimal but functional templates.
Youâ€™ll style them later with Bootstrap (in Lesson 11).

---

### ğŸ”¹ Step 5 â€” Test the Authentication Flow

1. **Run the dev server:**

   ```bash
   python manage.py runserver
   ```

2. Visit:

   * **Signup:** [http://127.0.0.1:8000/helpdesk/signup/](http://127.0.0.1:8000/helpdesk/signup/)
   * **Login:** [http://127.0.0.1:8000/accounts/login/](http://127.0.0.1:8000/accounts/login/) (or your custom login view if configured)
   * **Logout:** [http://127.0.0.1:8000/accounts/logout/](http://127.0.0.1:8000/accounts/logout/)

3. Try creating a new account and logging in/out.

4. Check in the admin panel â€” your new user should appear in the **User** list.

5. **Commit changes:**

   ```bash
   git add helpdesk/views.py helpdesk/urls.py templates/helpdesk/
   git commit -m "Add user signup, login, and logout views with templates"
   git push origin main
   ```

---

### ğŸ§­ Summary

| Step | Action                        | Result                          |
| ---- | ----------------------------- | ------------------------------- |
| 1    | Added Django auth URLs        | Enabled login/logout system     |
| 2    | Created helpdesk URL patterns | Added signup route              |
| 3    | Built authentication views    | Implemented signup/login/logout |
| 4    | Created HTML templates        | User-friendly interface         |
| 5    | Tested & committed            | Authentication works end-to-end |

---
